version: "3.8"

services:
  backend:
    build: ./backend
    container_name: localbasket-backend
    environment:
      - SERVER_PORT=${SERVER_PORT:-9000}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-https://localbasket.o-r.kr,http://localhost:8080}
      - UPLOAD_DIR=/app/uploads
      # (선택) 필요시 DB 환경변수도 추가
      # - DB_URL=jdbc:postgresql://192.168.35.89:5432/place_marker
      # - DB_USERNAME=marker
      # - DB_PASSWORD=실제비번
    ports:
      - "${SERVER_PORT:-9000}:9000"
    volumes:
      - ./backend/uploads:/app/uploads

  frontend:
    build: ./frontend
    container_name: localbasket-frontend
    ports:
      - "8080:80"

  nginx-proxy:
    image: jwilder/nginx-proxy
    container_name: nginx-proxy
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - ./data/certs:/etc/nginx/certs:ro
    environment:
      - VIRTUAL_HOST=localbasket.o-r.kr
      - LETSENCRYPT_HOST=localbasket.o-r.kr
